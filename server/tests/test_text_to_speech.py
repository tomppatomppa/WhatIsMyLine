import pytest
import os
import TextToSpeech
import shutil

data = {"filename": "Episode_s01e77__TI_vecka_16_2023_-_Dramatify.pdf", "scenes": [{"id": "SCRIPT DETAILS", "data": [{"type": "INFO", "name": "", "lines": "BUU-klubben 2023 \nTI vecka 16 2023\n(Season 1, Episode 77)\nElenda hj\u00e4lper till med musikvidion\nProduction no / code\nNya BUU-klubben\nBroadcast date\nStefanie af Bj\u00f6rksten (k\u00e4sikirjoittaja)\n7701", "id": "5e9d44ba-155d-489e-9bf2-b5c18afd53a0"}]}, {"id": "7701 INT. K\u00c4LLAREN", "data": [{"type": "INFO", "name": "", "lines": "Det \u00e4r dunkel belysning i k\u00e4llaren. Mitt i en liten\nljusk\u00e4gla vid en paffl\u00e5da st\u00e5r Elenda.\n(pahvilaatikkoetuala - vakkarit)", "id": "df2c22ec-9372-4c31-afcd-85608d095c06"}, {"type": "ACTOR", "name": "ELENDA", "lines": "(sjunger falskt)\nVem kan seeegla f\u00f6ruuuutan vind..\nveeem kan rooo utan \u00e5\u00e5\u00e5\u00e5\u00e5ror! Vemm..", "id": "c9a89c0e-1229-4ee6-980c-364e7bdc2ead"}, {"type": "INFO", "name": "", "lines": "Hissen kommer ner och Tika kommer ut ur hissen. Tika\ntittar p\u00e5 Elenda. Elenda slutar sjunga.", "id": "2c3e50e1-f842-44a4-be39-86b2b92de8b0"}, {"type": "ACTOR", "name": "TIKA", "lines": "Men hej Elenda! Och hej buuklubbis!\nH\u00e4r st\u00e5r du och.. sjunger!", "id": "8f383bf8-fa0f-4962-8e44-605a9a100603"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Ja! E de int sorgligt?", "id": "6915e344-97bb-4e85-9a82-d7756e58be79"}, {"type": "INFO", "name": "", "lines": "Tika funderar.", "id": "819f8097-7183-4c03-8241-6a2c9709c8cc"}, {"type": "ACTOR", "name": "TIKA", "lines": "Ja tycker de e roligt att sjunga!", "id": "dbe43bd6-f439-4907-b921-599900675322"}, {"type": "ACTOR", "name": "ELENDA", 
"lines": "Ja men ja men ju s\u00e5klart s\u00e5ngen!", "id": "82d7d583-1f5c-4f5f-84f2-fb3431d1ed4c"}, {"type": "ACTOR", "name": "TIKA", "lines": "N\u00e5 den l\u00e4t nog sorlig, det har du\nr\u00e4tt i.", "id": "73b33804-dada-4ed3-bf4f-5cb116f89703"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Den handlar om f\u00f6rlust.", "id": "c1e6e538-e6c9-4ab7-8d78-8f322ba4ae3d"}, {"type": "ACTOR", "name": "TIKA", "lines": "Mm..", "id": "f835114c-26fd-4c47-820a-aab6d00a6a74"}, {"type": "ACTOR", "name": "ELENDA", "lines": "(sjunger igen)\nVeeeem kan seeegla f\u00f6r uuuuuutaan\nviiind. Veeeem kan roooo utan \u00e5\u00e5\u00e5ror.\nMen ej skiljas fr\u00e5n v\u00e4\u00e4\u00e4nnen sin.\nUtan att f\u00e4lla t\u00e5\u00e5\u00e5rar.", "id": "c00d2084-850d-4fef-a21f-08fc986a6cd3"}, {"type": "ACTOR", "name": "TIKA", "lines": "N\u00e5 de e nog verkligen en sorglig s\u00e5ng\nded\u00e4r. Hej! Ja sku beh\u00f6va hj\u00e4lp me en\ngrej som har att g\u00f6ra just precis med\nmusik! Tror du att du sku kunna\nhj\u00e4lpa mej?", "id": "41ff61a5-6487-43fb-b32b-03f1720e12a0"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Jag? (forts repl som passar in och\nbekr\u00e4ftar att hon ska hj\u00e4lpa)\n7702", "id": "a74e5c41-21da-476d-9799-9969236979ab"}]}, {"id": "7702 EXT. TORNET", "data": [{"type": "INFO", "name": "", "lines": "Helbild av tornet. LJUD: jingle.\n7703", "id": "b477baf2-74e1-441e-8f76-8e9af04cedc1"}]}, {"id": "7703 INT. K\u00c4LLAREN", "data": 
[{"type": "INFO", "name": "", "lines": "Tika st\u00e5r en bit fr\u00e5n Elenda som \u00e4r i f\u00f6rgrunden med en\ntelefon f\u00f6r att filma.\n(Smartpuhelin jolla voi kuvata)", "id": "3fd515f3-31f5-4ded-bd6d-84032b94e2b8"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Ja f\u00f6rst\u00e5r int \u00e4nnu heller varf\u00f6r du\nvill att ja ska st\u00e5 BAKOM kameran..", "id": "708d0aec-21a3-4ec7-bf9f-3263f40d1988"}, {"type": "ACTOR", "name": "TIKA", "lines": "Vi kan byta sen. Men filma nu, okej?", "id": "9c29303d-417d-4473-b01d-66fce45226a7"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Det kommer g\u00e5 \u00e5t pipan, sanna mina\nord. En mus bakom kameran. Ha ni h\u00f6rt\nn\u00e5t mer bef\u00e4ngt?", "id": "28fab72f-e733-49fd-aaf6-e5a4d2396aeb"}, {"type": "ACTOR", "name": "TIKA", "lines": "Okej! Ja s\u00e4tter p\u00e5 musiken o s\u00e5\nfilmar du n\u00e4r ja sjunger me o dansar?", "id": "aa370610-d994-4c70-9b0e-665ad709c165"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Ja ja.", "id": "4e9196ac-7c2d-4347-9025-243c9837626d"}, {"type": "INFO", "name": "", "lines": "Tika s\u00e4tter p\u00e5 musiken och LJUD: buus\u00e5ngen, drar ig\u00e5ng.\nTika dansar. Elenda filmar.", "id": "ffdef50d-b9de-4d6b-b310-0f30adcf0f31"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Bryt!", "id": "b41016b8-b478-434b-bc4f-03fe39f7d75b"}, {"type": "INFO", "name": "", "lines": "Tika slutar dansa och st\u00e4nger av musiken.", "id": "3fd21e90-f132-42a6-9123-34785fa9618d"}, {"type": "ACTOR", "name": "ELENDA", "lines": "De e helt.. f\u00f6r hoppsigt! Det finns\nju ingen seriositet! Inga skuggor..\ninga nyanser!", "id": "a1d5dfe2-50c6-4a78-aec0-2d17f7d8fdb5"}, {"type": "ACTOR", "name": "TIKA", "lines": "Eh.. okej! Ja provar p\u00e5nytt.", 
"id": "5de138ae-400a-41b4-a275-51af829fcb53"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Bra. Och vars\u00e5god!", "id": "816e697e-fb04-4d5c-87da-2b8542865c10"}, {"type": "INFO", "name": "", "lines": "Tika s\u00e4tter p\u00e5 musiken igen och b\u00f6rjar dansa. Elenda\nfilmar.", "id": "2e1be46a-ba41-4d83-90fc-70420f224845"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Bryt!", "id": "856f3f75-a333-4b50-a78e-1b37f3e3edf3"}, {"type": "INFO", "name": "", "lines": "Tika slutar dansa och st\u00e4nger av musiken.", "id": "42c5cdfa-2a0c-4f63-b2e5-7212ba1e28da"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Du g\u00f6r ju bara samma sak! Buddu\ndudududuuuu.. livet \u00c4R inte bara\ntrallallaaa. Du vill v\u00e4l ha me ALLT i\nlivet! Inte bara solsken och..\nregnb\u00e5gar. V\u00e4nta h\u00e4r s\u00e5 ska ja h\u00e4mta\nlite grejer fr\u00e5n f\u00f6rr\u00e5det!", 
"id": "596f9761-b482-48ac-8be5-01e867c43b01"}, {"type": "INFO", "name": "", "lines": "Elenda ur bild. Tika tittar f\u00f6rundrat mot kameran.\n7704", "id": "11b2c05d-bc8f-4ed2-8cef-3da20cec007a"}]}, {"id": "7704 EXT. TORNET", "data": [{"type": "INFO", "name": "", "lines": "Helbild av tornet.\n7705", "id": "d47a78b5-2611-4352-bbd6-72bd0882072e"}]}, {"id": "7705 INT. MUSSKETCH", "data": 
[{"type": "INFO", "name": "", "lines": "Random mussketch. INSPELAD.\n7706", "id": "78f7435f-83b9-4fe2-8f5c-1ff543767ce1"}]}, {"id": "7706 INT. K\u00c4LLAREN", "data": [{"type": "INFO", "name": "", "lines": "Tika st\u00e5r ensam i en ljusk\u00e4gla med en k\u00e5pa p\u00e5 sig som\nliknar Elendas. I handen har hon en kantele.\n(Kantele - toimiva mutta ei tarvitse kuulostaa hyv\u00e4lt\u00e4,\npuhelin jolla voi kuvata)", "id": "328036a2-2520-48dc-8dc8-e1bf90120446"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Okej! Nu tar vi det utan den d\u00e4r\nskr\u00e5liga musiken. Ta o dra p\u00e5\nkantelen en sv\u00e4ng s\u00e5 f\u00e5r ja h\u00f6ra.", "id": "a8ae6070-5504-40b7-bc11-8da48b2ac3f5"}, {"type": "INFO", "name": "", "lines": "Tika drar p\u00e5 kantelen.", "id": "4c3bbf65-a249-4f11-baee-cf571f09cc10"}, {"type": "ACTOR", "name": "TIKA", "lines": "S\u00e5h\u00e4r d\u00e5?", "id": "0b8a6b8a-7446-4fd3-a2d6-ec1e6ce8f9c5"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Ja! Ja! Just s\u00e5d\u00e4r! Okej. D\u00e5 tar vi\ndet fr\u00e5n b\u00f6rjan. Riktigt l\u00e5ngsamt\noch... med skugga!", "id": "bf72456c-8032-49bc-95d0-71748c1033c2"}, {"type": "INFO", "name": "", "lines": "Elenda b\u00f6rjar filma. Tika drar \u00f6ver kantelen en sv\u00e4ng\noch b\u00f6rjar dansa.", "id": "29572bf1-24b4-410c-a77d-2aa9227e5c4c"}, {"type": "ACTOR", "name": "TIKA", "lines": "(sjunger i moll)\nBuu duuud duuuuduu.", "id": "72f26a02-3f0e-4690-84cd-64f774b11e2d"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Bryt! Du m\u00e5ste k\u00e4nna skuggan i dansen\nocks\u00e5! Och vars\u00e5god!", "id": "8c7e491c-ac6f-4258-a81c-c67cbdcfb6c1"}, {"type": "INFO", "name": "", "lines": "Tika drar p\u00e5 kantelen och sjunger i moll. Dansar med\nsvepande r\u00f6relser.", "id": "392aa24a-3f1d-4ad5-853d-0f1b97e16ca4"}, {"type": "ACTOR", "name": "TIKA", "lines": "(sjunger i moll)\nH\u00f6rdu vet du va.. ja e gla ida..", "id": "3e117d18-c89c-4ca7-b40e-b7c416dbb35b"}, {"type": "INFO", "name": "", "lines": "Tika stannar upp.", "id": "2516af75-5ab4-49bf-bf78-7215a51008b0"}, {"type": "ACTOR", "name": "TIKA", "lines": "De h\u00e4r g\u00e5r ju int!", "id": "9ad1b008-d200-4284-a333-16b956a2066b"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Va? De va din b\u00e4sta tagning hittills!", "id": "3ecacb3d-47ae-42f1-9a0a-949ec2cae1c1"}, {"type": "ACTOR", "name": "TIKA", "lines": "Ja kan ju int sjunga att ja e glad\nfast s\u00e5ngen l\u00e5ter lessen!", "id": "0550ff5f-675c-4f87-82f7-39551f41668a"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Men de e ju fantastiskt! Vilken\nkontrast!", "id": "e027e431-b4bd-47f6-a019-31337d793cab"}, {"type": "ACTOR", "name": "TIKA", "lines": "N\u00e4 vet du va.. nu beh\u00f6ver vi lite\nglad energi h\u00e4r tror ja!", "id": "6a486b72-fb89-4f36-9f11-d85ce60d3d11"}, {"type": "INFO", "name": "", "lines": "Kvicki upp.", "id": "2c2d4a92-b6bb-431e-a42b-1965dad7f261"}, {"type": "ACTOR", "name": "KVICKI", "lines": "Dags f\u00f6r glad energi! 3-2-1- \u00f6ver\ntill Lili och Acke!", "id": "2e0dd880-db55-4af9-9f6c-c877e8476394"}, {"type": "ACTOR", "name": "TIKA", "lines": "Perfekt!", "id": "1be78323-62e6-405d-a41d-cb72af56694a"}, {"type": "INFO", "name": "", "lines": "De tittar mot kameran.\n7707", "id": "76c4c3f4-e005-46f5-8fb3-333849f3340a"}]}, {"id": "7707 BUU P\u00c5 SPR\u00c5NG", "data": [{"type": "INFO", "name": "", "lines": "Lili 9 & Acke 5 Hoppar i trampolinen. Ca 2 min.\n7708", "id": "8c98d66a-5097-413c-88a4-951f851f7984"}]}, {"id": "7708 EXT. TORNET", "data": [{"type": "INFO", "name": "", "lines": "Helbild av tornet.\n7709", "id": "697627fa-1e19-47ce-9f88-baffac1040b2"}]}, {"id": "7709 INT. K\u00c4LLAREN", "data": [{"type": "INFO", "name": "", "lines": "Tika st\u00e5r i samma k\u00e5pa och med kantelen i handen. Lisa\nsitter vid en harpa.\n(Kantele - sama kuin edellisess\u00e4 kohtauksessa, Harppu -\ntoimiva, Puhelin jolla voi kuvata)", "id": "d96cfdd3-9d52-435a-965d-5303db14b25e"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Och vars\u00e5goda!", "id": "6a795166-df5f-4c39-9016-13170725391a"}, {"type": "INFO", "name": "", "lines": "De drar p\u00e5 sina str\u00e5kinstrument.\nLISA OCH TIKA\n(sjunger i moll)\nH\u00f6rdu vet du vad. Jag \u00e4r glad idag..\nDe drar igen p\u00e5 sina str\u00e5kar.\nLISA OCH TIKA\n(sjunger)\nO en annan grej.. ja tycker s\u00e5 om\ndej.. Vi e h\u00e4r tillsammans.. firar me\nv\u00e5r buudans..\nLisa slutar spela.", "id": "6d49c81e-1285-4b47-9a86-b3e117461017"}, {"type": "ACTOR", "name": "LISA", "lines": "Men vi dansar ju int. Vi sitter ju\nbara! Ja tycker att om vi g\u00f6r en\nmusikvideo f\u00f6r fredagsdansen.. s\u00e5\nm\u00e5st vi ju nog dansa i den videon.", "id": "e23f0622-e1cc-432d-a88d-17641026168b"}, {"type": "INFO", "name": "", "lines": "KONTROLLMUS 1 (O.S.)\nO ha me snabba bilar i videon!", "id": "e689b6e9-37f6-4e4a-bb20-52af77e21341"}, {"type": "ACTOR", "name": "LISA", "lines": "N\u00e5 ja.. de vet ja int.. men vi m\u00e5st\ndansa i alla fall.", "id": "d46a4df4-00ae-449d-97ee-543de0ce41ce"}, {"type": "ACTOR", "name": "ELENDA", "lines": "\u00c4h! Som ni vill. L\u00e5t mig visa hur man\ng\u00f6r. Framf\u00f6r kameran.\n7710", "id": "757f9135-ad37-4f77-8374-1cf290b807f4"}]}, {"id": "7710 INT. K\u00c4LLAREN", "data": [{"type": "INFO", "name": "", "lines": "Lisa och Tika i f\u00f6rgrunden. Lisa filmar Elenda som \u00e4r\nmitt i den lilla ljusk\u00e4glan. Hon drar p\u00e5 kantelen.", "id": "463b6dff-39c2-431c-bab6-1e88972c4e1c"}, {"type": "ACTOR", "name": "ELENDA", "lines": "(sjunger i moll)\nH\u00f6rdu vet du vad. Jag \u00e4r glad idag..", "id": "9788915c-7910-4476-a3a5-62d422c79715"}, {"type": "INFO", "name": "", "lines": "Hon drar igen p\u00e5 kantelen.", "id": "5e20f1c3-f570-491f-815e-e75bd0d08f17"}, {"type": "ACTOR", "name": "ELENDA", "lines": "(sjunger)\nO en annan grej.. ja tycker s\u00e5 om\ndej.. Vi e h\u00e4r tillsammans.. firar me\nv\u00e5r buudans..", "id": "47176bd9-9c0c-46fe-8fb8-855e668093f0"}, {"type": "INFO", "name": "", "lines": "Tika v\u00e4nder sig mot kameran.", "id": "085192bf-7ada-4d79-956a-24d70f526613"}, {"type": "ACTOR", "name": "TIKA", "lines": "(viskar)\nVet du va buuklubbis.. ja tror att vi\nf\u00e5r ta ett nytt f\u00f6rs\u00f6k med\nmusikvideon imorgon... hejd\u00e5!", "id": "d7baa0e1-3692-4396-a379-99bb7d3abf6d"}, {"type": "ACTOR", "name": "ELENDA", "lines": "Buuuu dududuududuudddduu..\nSLUT", "id": "68a01c8e-5b90-4acf-a1a7-83125bd8617a"}]}], "id": "64b5fc73-4667-4886-a3e8-e47e8cc3cce2"}

data_small = {
    'filename': 'Episode_s01e77__TI_vecka_16_2023_-_Dramatify.pdf',
    'id': '64b5fc73-4667-4886-a3e8-e47e8cc3cce2',
    'scenes': [
        {
            'id': '7706 INT. KÄLLAREN',
            'data': [
                {
                    'id': '3a6d3e51-2671-4260-a5df-4a328cf4c6e3',
                    'lines': 'Kommer nu',
                    'name': 'ALEXANDER',
                    'type': 'ACTOR'
                },
                {
                    'id': '1e48525b-7ae2-48e5-8a46-2e0079603f5',
                    'lines': 'Okej! Nu tar vi det utan den där',
                    'name': 'ELENDA',
                    'type': 'ACTOR'
                }
            ] 
        }
    ]
}

                                    

def test_should_create_correct_folder_structure() -> None:
    TextToSpeech.create_folders(data_small)

    root_folder_path = f'processed_audio/{data_small["id"]}'

    assert os.path.exists(root_folder_path), f"The folder '{root_folder_path}' does not exist."

    scene_folders = [scene["id"] for scene in data_small["scenes"]]

    subfolder_path = os.path.join(root_folder_path, f"{data_small['id']}")
   
    for folder in scene_folders:
        subfolder_path = os.path.join(root_folder_path, folder)
        assert os.path.exists(subfolder_path), f"The subfolder '{subfolder_path}' does not exist."

    shutil.rmtree(root_folder_path)


def test_should_created_mp3_files_in_correct_folders() -> None:
    TextToSpeech.create_folders(data_small)
    TextToSpeech.create_audio(data_small)

    path_to_first_scene = f'processed_audio/{data_small["id"]}/{data_small["scenes"][0]["id"]}'
    mp3_files = [file for file in os.listdir(path_to_first_scene) if file.endswith('.mp3')]

    expected_filenames = [line["id"]+".mp3" for line in data_small["scenes"][0]["data"]] # get line ids 

    for expected_filename in expected_filenames:
       assert expected_filename in mp3_files, f"Expected filename '{expected_filename}' not found in the subfolder: {path_to_first_scene}"
   